<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<html lang="es">
    <head>
	
	<script src="./js/fire.js"></script>
	<script>
		 var config = {
    apiKey: "AIzaSyBZZ5MeNwP_mGa4jD1w5OXGaPbrgNO6R-g",
    authDomain: "invitados-7fe3d.firebaseapp.com",
    databaseURL: "https://invitados-7fe3d.firebaseio.com",
    projectId: "invitados-7fe3d",
    storageBucket: "invitados-7fe3d.appspot.com",
    messagingSenderId: "846946400809"
  };
  firebase.initializeApp(config);
  const dbRef = firebase.database().ref();
  const usersRef = dbRef.child('users');
  
  function arrayJSON(nombre,telefono,correo){
  var data = [nombre,telefono,correo];
  return data;	   
  }
  
  function getID(id){
     return document.getElementById(id).value;
  }
    function insertTask(){
	 var nombre = getID("name");
	 var telefono = getID("company");
	 var correo = getID("email");
	 
	 var arrayData = arrayJSON(nombre,telefono,correo);
	  firebase.database().ref('Usuarios/' + nombre).set({
    correo: correo,
    tel: telefono,
    nombre : nombre
  });
	    var data = {};
    data.name = document.getElementById("name").value;
    data.email = document.getElementById("email").value;
    alert("Hola, "+data.name +"\n"+"Ya puedes disfrutar de nuestro servicio!");
    console.log("Storing data to db...", data);

    // Complete Login
    authUser();
	}
var base_grant_url = decodeURIComponent(GetURLParameter("base_grant_url"));
var user_continue_url = decodeURIComponent(GetURLParameter("user_continue_url"));
var node_mac = GetURLParameter("node_mac");
var client_ip = GetURLParameter("client_ip");
var client_mac = GetURLParameter("client_mac");

// Print Meraki provided paramaters for Debugging State
console.log("user_continue_url: "+user_continue_url);
console.log("client_ip: "+client_ip);
document.getElementById("baseGrantURL").innerHTML = base_grant_url;
document.getElementById("userContinueURL").innerHTML = user_continue_url;
document.getElementById("clientIP").innerHTML = client_ip;
document.getElementById("clientMAC").innerHTML = client_mac;
document.getElementById("nodeMAC").innerHTML = node_mac;

 
function authUser(){

    var loginUrl = base_grant_url;
    if(user_continue_url !== "undefined"){
        loginUrl += "?continue_url="+user_continue_url;
    }
    console.log("Logging in... ",loginUrl);
    // redirect browser to meraki auth URL.
    window.location.href = loginUrl;
}


// Helper function to parse URL
function GetURLParameter(sParam)
{
    var sPageURL = window.location.search.substring(1);
    var sURLVariables = sPageURL.split('&');
    for (var i = 0; i < sURLVariables.length; i++) 
    {
        var sParameterName = sURLVariables[i].split('=');
        if (sParameterName[0] == sParam) 
        {
            return sParameterName[1];
        }
    }
}
	    </script>
        <link rel="stylesheet" type="text/css" href="./css/style.css">
    </head>
    <div class="container">  
      
      <form id="loginForm">
        <center><a href="http://developers.meraki.com"><img src="./img/logo.png" width="50%"/></a></center>
        <br>
        <fieldset>
          <input id="name" placeholder="Nombre" type="text" tabindex="1" required autofocus>
        </fieldset>
        <fieldset>
          <input id="email" placeholder="Correo Electrónico" type="email" tabindex="2" required>
        </fieldset>
        <fieldset>
          <input id="company" placeholder="Número Teléfonico" type="text" tabindex="3">
        </fieldset>
		 <input type="checkbox" name="terminos" value="" required> Estoy de acuerdo con los terminos y condiciones del servicio<br>
        <fieldset>
          <button type="submit" onclick="insertTask()">Acceder a Internet</button>
        </fieldset>
		
        <!--<p class="copyright">Sample by <a href="http://www.InternetOfLEGO.com" target="_blank" title="Internet of LEGO">Internet of LEGO</a></p>-->
      </form>
    </div>
    <hr>
    <h4>Debugging Stats</h4>
    <p><label>Base Grant URL: </label><label id="baseGrantURL"></label></p>
    <p><label>User Continue URL: </label><label id="userContinueURL"></label></p>
    <p><label>Client IP: </label><label id="clientIP"></label></p>
    <p><label>Client MAC: </label><label id="clientMAC"></label></p>
    <p><label>Access Point MAC: </label><label id="nodeMAC"></label></p>
   
</html>

